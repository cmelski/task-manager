<!DOCTYPE HTML>


<html xmlns="http://www.w3.org/1999/html">
<head>
    <title>List Details</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
    <link rel="stylesheet" href="/static/assets/css/main.css"/>
    <noscript>
        <link rel="stylesheet" href="/static/assets/css/noscript.css"/>
    </noscript>
    <style>
        input {
           font-weight:bold;
           color: #818385;
        }

  /* Tooltip container */
  .tooltip {
    position: relative;
    display: inline-block;
    border-bottom: 0px dotted black; /* If you want dots under the hoverable text */
  }

  /* Tooltip text */
  .tooltip .tooltiptext {
    visibility: hidden;
    width: 100px;
    background-color: black;
    color: #fff;
    text-align: center;
    padding: 0px 0;
    border-radius: 6px;
    font-size: 16px;

    /* Position the tooltip text - see examples below! */
    position: absolute;
    z-index: 1;
  }

  /* Show the tooltip text when you mouse over the tooltip container */
  .tooltip:hover .tooltiptext {
    visibility: visible;
  }

.calendar-days td.selected {
background-color: #2563eb;
color: white;
border-radius: 3px;
}


.calendar-days td.today {
border: 1px solid #2563eb;
border-radius: 3px;
}


.calendar-days td {
width: 24px;
height: 24px;
text-align: center;
vertical-align: middle;
cursor: pointer;
}


.calendar-popup {
display: none;
position: absolute;
background: white;
border: 1px solid #ccc;
padding: 4px;
z-index: 10;
}


.calendar-wrapper {
position: relative;
}
</style>
</head>
<body class="is-preload">
<!-- Wrapper -->
<div id="wrapper">

    <!-- Header -->
    <header id="header">
        <div class="inner">

            <!-- Logo -->
            <a href="" class="logo">
                <span class="title"></span>
                <img src="/static/images/ToDo.jpeg">

            </a>

            <!-- Nav -->
            <nav>
                <ul>
                    {% if current_user.is_authenticated: %}
                    <div class="tooltip"><span style="font-size: 24px;">üë§</span><span class="tooltiptext">{{current_user.name}}</span>
                    </div>
                    <li><a href="#menu">Menu</a></li>

                    {% else: %}
                    <li><a href="#menu">Menu</a></li>
                    {% endif %}
                </ul>
            </nav>

        </div>
    </header>

    <!-- Menu -->
    <nav id="menu">
        <h2>Menu</h2>
        <ul>
            <li style="font-weight: bold"><a href="{{ url_for('home')}}">Home</a></li>
            {% if not current_user.is_authenticated: %}
            <li style="font-weight: bold"><a href="{{ url_for('login') }}">Log In</a></li>
            <li style="font-weight: bold"><a href="{{ url_for('register_user') }}">Register</a></li>
            {% endif %}
            {% if current_user.is_authenticated: %}
            <li style="font-weight: bold">List Actions:</li>
            <div class="tooltip"><span style="font-size: 24px;"><a
                    href="{{ url_for('clone_list', list_id = list_id,list_name=list_name)}}">üîÅ</a></span><span
                    class="tooltiptext">Clone List</span></div>
            <br>
            <div class="tooltip"><span style="font-size: 24px;"><a
                    href="{{ url_for('save_to_csv', list_id = list_id,list_name=list_name)}}">üìÅ</a></span><span
                    class="tooltiptext">Export to CSV</span></div>
            <form id="my_form2" method="POST" action="{{ url_for('email_list',list_id = list_id)}}">
                <div class="tooltip"><span style="font-size: 24px;"><a href="javascript:{}"
                                                                       onclick="document.getElementById('my_form2').submit();">‚úâÔ∏è</a></span><span
                        class="tooltiptext">Email List</span></div>
                <input type="text" style="font-style: italic" name="recipient" id="recipient2"
                       placeholder="<Recipient Email>"/>
            </form>
            <li style="font-weight: bold">All Lists:</li>
            {% for list in lists: %}

            <object style="text-indent: 50px"><a style="color: white; font-size: 16px"
                                                 href="{{ url_for('show_list_details',list_id = list[0]) }}">{{list[2]}}</a>
            </object>
            <br>

            {% endfor %}
            <li style="font-weight: bold"><a href="{{ url_for('logout') }}">Log Out</a></li>
            {% endif %}

        </ul>
    </nav>

    <!-- Main -->
    <div id="main"
         style="background-image: url('/static/images/checklist.jpeg'); background-size: cover; background-repeat: no-repeat">
        <div class="inner">
            {% with messages = get_flashed_messages() %}
            {% if messages %}
            {% for message in messages %}
            <p class="flash" style="font-size: 20px;color:#ff0000; font-weight: bold; font-style: italic">{{ message
                }} </p>
            {% endfor %}
            {% endif %}
            {% endwith %}

            <div id="message" style="display:none; color: red; font-weight: bold;">
            </div>


            <form id=500 method="POST" action="{{ url_for('update_list_name',list_id = list_id)}}">
                <div class="fields">
                    <div class="field half">

                        <input type="text" name="list_name" style="font-size: 30px;font-weight: bold"
                               value="{{list_name}}"/>

                    </div>
                </div>
            </form>


            <form id="item_list" method="POST" action="{{ url_for('update_all_list_items',list_id = list_id)}}">
            <button id="addRowBtn" type="button">+ Add Row</button> <button id="loadCsvBtn" type="button">üìÇ Load CSV</button><button id="downloadCsvTemplate" type="button">üìÑ Download CSV Template</button><button id="saveAll" type="submit">Save All</button>
                 <input type="file" id="csvFile" accept=".csv" style="display:none;">

                 <table class="task-table" id="task_table">
                <thead>
                <tr>
                    <th scope="col">Task Name</th>
                    <th scope="col">Due Date</th>
                    <th scope="col">Assignee</th>
                    <th scope="col">Notes</th>
                    <th scope="col">Completed</th>
                    <th scope="col"></th>
                    <th scope="col"></th>

                </tr>

                </thead>

                <tbody>




                    <tr>
                        {% set data = [] %}
                        {% for i in range(0,requested_list|length): %}
                        {% set n = i|string %}

                        <td><input id={{requested_list[i].id}} type="text" style="font-weight:bold;color: #818385;"
                                   name="task_{{n}}" value="{{requested_list[i][2]}}"/></td>
                        <td>
                            <div class="calendar-wrapper">
                                <input type="text" class="date-input" name="due_{{n}}" value="{{requested_list[i][3]}}"
                                       readonly
                                       data-testid="date-input"/>
                                <div class="calendar-popup" data-testid="calendar-popup">
                                    <div class="calendar-header">
                                        <button class="prev-month" data-testid="prev-month">‚óÄ</button>
                                        <span class="month-label" data-testid="month-label">Month Year</span>
                                        <button class="next-month" data-testid="next-month">‚ñ∂</button>
                                    </div>
                                    <table>
                                        <thead>
                                        <tr>
                                            <th>Su</th>
                                            <th>Mo</th>
                                            <th>Tu</th>
                                            <th>We</th>
                                            <th>Th</th>
                                            <th>Fr</th>
                                            <th>Sa</th>
                                        </tr>
                                        </thead>
                                        <tbody class="calendar-days" data-testid="calendar-days"></tbody>
                                    </table>
                                </div>
                            </div>
                        </td>
                        <!--  <td><input type="date" name="due_{{n}}" value="{{requested_list[i][3]}}"/></td> -->
                        <td><input type="text" name="assign_{{n}}" list="assignPerson"
                                   value="{{requested_list[i][4]}}"/>
                            <datalist id="assignPerson">
                                <option value="Chris">Chris</option>
                                <option value="Karen">Karen</option>
                            </datalist>
                        </td>
                        <td><textarea name="notes_{{n}}" rows="3" cols="8"
                                      style="background-color:#ffffff;font-size: 14px">{{requested_list[i][5]}}</textarea>
                        </td>
                        {% if requested_list[i][6] == 1: %}
                        <td><input type="checkbox" name="complete_{{n}}" checked
                                   style="opacity:1;appearance:checkbox;margin-right:0"/></td>
                        {% else: %}
                        <td><input type="checkbox" name="complete_{{n}}"
                                   style="opacity:1;appearance:checkbox;margin-right:0"/></td>
                        {% endif %}


                        <td>
                            <div class="tooltip"><a
                                    href="{{ url_for('delete_list_item',list_item_id=requested_list[i][0],list_id = list_id)}}">üóëÔ∏è</a><span
                                    class="tooltiptext">Delete</span></div>
                        </td>
                        {% if lists|length > 1 and requested_list[i][0] > 0: %}
                        <td>
                            <div class="tooltip"><a
                                    href="{{ url_for('delete_list_item',list_item_id=requested_list[i][0],list_id = list_id)}}">‚û°Ô∏è</a><span
                                    class="tooltiptext">Move</span></div>
                        </td>
                        {% else: %}

                        {% endif %}
                    </tr>
                    {% do data.append(requested_list[i][0]) %}
                    {% endfor %}


                    <input type="hidden" name="ids" value="{{ data }}">







                </tbody>
            </table>

                  </form>


        </div>


    </div>

    <!-- Footer -->
    <footer id="footer">
        <div class="inner">
            <ul class="copyright">
                <li>&copy; Untitled. All rights reserved</li>
            </ul>
        </div>
    </footer>

</div>

<!-- Scripts -->
<script>

function initCalendar(wrapper) {
    const input = wrapper.querySelector('.date-input');
    const popup = wrapper.querySelector('.calendar-popup');
    const daysEl = wrapper.querySelector('.calendar-days');
    const monthLabel = wrapper.querySelector('.month-label');
    const prevBtn = wrapper.querySelector('.prev-month');
    const nextBtn = wrapper.querySelector('.next-month');

    // Each wrapper gets its own state
    let current = new Date();
    let selected = null;

    function pad(n){ return n<10?'0'+n:n; }
    function fmt(d){ return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`; }

    function render(){
        const year = current.getFullYear(), month = current.getMonth();
        monthLabel.textContent = current.toLocaleString('default',{month:'short'})+' '+year;
        daysEl.innerHTML = '';

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month+1, 0).getDate();
        let row = document.createElement('tr');

        const selectedIso = selected ? fmt(selected) : null;
        const today = new Date();
        const todayIso = fmt(today);

        for(let i=0;i<firstDay;i++) row.appendChild(document.createElement('td'));
        for(let d=1; d<=daysInMonth; d++){
            const cell = document.createElement('td');
            const date = new Date(year, month, d);
            const iso = fmt(date);
            cell.textContent = d;
            cell.setAttribute('data-testid', `day-${iso}`);

            if(selectedIso === iso) cell.classList.add('selected');
            if(todayIso === iso) cell.classList.add('today');

            cell.addEventListener('click', ()=>{
                selected = new Date(date.getFullYear(), date.getMonth(), date.getDate());
                input.value = fmt(selected);
                popup.style.display = 'none';
                render();
            });

            row.appendChild(cell);
            if((firstDay+d)%7===0 || d===daysInMonth){
                daysEl.appendChild(row);
                row = document.createElement('tr');
            }
        }
    }

    // Initialize selected from input value
    if(input.value){
        const val = new Date(input.value);
        selected = new Date(val.getFullYear(), val.getMonth(), val.getDate());
        current = new Date(val.getFullYear(), val.getMonth(), 1);
    } else {
        selected = null;
        current = new Date();
        input.value = '';
        input.placeholder = 'Select Date';
    }

    popup.style.display = 'none';
    render();

    // Toggle popup
    input.addEventListener('click', e => {
        e.stopPropagation();
        document.querySelectorAll('.calendar-popup').forEach(p => {
            if(p !== popup) p.style.display = 'none';
        });
        popup.style.display = popup.style.display==='block'?'none':'block';
        render();
    });

    // Month navigation
    prevBtn.addEventListener('click', e=>{
        e.stopPropagation();
        current = new Date(current.getFullYear(), current.getMonth()-1,1);
        render();
    });
    nextBtn.addEventListener('click', e=>{
        e.stopPropagation();
        current = new Date(current.getFullYear(), current.getMonth()+1,1);
        render();
    });

    // Close popup on outside click
    document.addEventListener('click', e=>{
        if(!wrapper.contains(e.target)) popup.style.display = 'none';
    });
}

// Initialize existing calendars at page load
document.querySelectorAll('.calendar-wrapper').forEach(initCalendar);


</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const addRowBtn = document.getElementById("addRowBtn");
  const tableBody = document.querySelector("#task_table tbody");
  const loadCsvBtn = document.getElementById("loadCsvBtn");
  const csvFile = document.getElementById("csvFile");
  const downloadTemplate = document.getElementById("downloadCsvTemplate");

  // --- CSV Template Download ---
  downloadTemplate.addEventListener("click", () => {
    window.location.href = "/download_template";
  });

  // --- Helper: Get next index ---
  function getNextIndex() {
    const inputs = tableBody.querySelectorAll('input[name^="task_"]');
    if (inputs.length === 0) return 0;
    const lastInputName = inputs[inputs.length - 1].name;
    return parseInt(lastInputName.split("_")[1], 10) + 1;
  }

  // --- Helper: Check for duplicates ---
  function checkForDuplicates() {
    const inputs = tableBody.querySelectorAll('input[name^="task_"]');
    const values = Array.from(inputs)
      .map(i => i.value.trim())
      .filter(v => v !== '');
    const seen = new Set();
    let duplicateCount = 0;

    for (const val of values) {
      if (seen.has(val)) duplicateCount++;
      seen.add(val);
    }
    return duplicateCount;
  }

  // --- Add Row ---
  addRowBtn.addEventListener("click", () => {
    const nextIndex = getNextIndex();
    const newRow = tableBody.insertRow();
    newRow.innerHTML = `
      <td><input type="text" name="task_${nextIndex}" placeholder="Enter task name"></td>
      <td>
        <div class="calendar-wrapper">
          <input type="text" class="date-input" name="due_${nextIndex}" placeholder="Select date" readonly>
          <div class="calendar-popup">
            <div class="calendar-header">
              <button class="prev-month">‚óÄ</button>
              <span class="month-label">Month Year</span>
              <button class="next-month">‚ñ∂</button>
            </div>
            <table>
              <thead>
                <tr><th>Su</th><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th></tr>
              </thead>
              <tbody class="calendar-days"></tbody>
            </table>
          </div>
        </div>
      </td>
      <td><input type="text" name="assign_${nextIndex}" placeholder="Select/Enter assignee" list="assignPerson">
        <datalist id="assignPerson">
          <option value="Chris">Chris</option>
          <option value="Karen">Karen</option>
        </datalist>
      </td>
      <td><textarea name="notes_${nextIndex}" placeholder="Enter notes"></textarea></td>
      <td><input type="checkbox" name="complete_${nextIndex}" style="opacity:1;appearance:checkbox;margin-right:0"></td>
      <td><button class="deleteRowBtn">‚úò</button></td>
      <td></td>
    `;
    if (typeof initCalendar === "function") {
      initCalendar(newRow.querySelector(".calendar-wrapper"));
    }
  });

  // --- Delete Row (delegated) ---
  tableBody.addEventListener("click", (event) => {
    const messageDiv = document.getElementById("message");
    if (event.target.classList.contains("deleteRowBtn")) {
      event.target.closest("tr").remove();
    }

    const duplicate = checkForDuplicates();
    if (duplicate > 0) {
      messageDiv.style.display = "block";
      messageDiv.textContent = `‚ö†Ô∏è ${duplicate} duplicate task name${duplicate > 1 ? 's' : ''} found!`;
    } else {
      messageDiv.style.display = "none";
    }
  });

  // --- CSV Loader ---
  loadCsvBtn.addEventListener("click", () => csvFile.click());

 csvFile.addEventListener("change", (event) => {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (e) => {
        loadCsvToTable(e.target.result);

        // ‚úÖ Reset the input so the same file can be selected again
        csvFile.value = '';
    };
    reader.readAsText(file);
});

  function loadCsvToTable(csvText) {
    const rows = csvText.trim().split("\n");
    const messageDiv = document.getElementById("message");

    for (const row of rows.slice(1)) {
      const cols = row.split(",");
      const nextIndex = getNextIndex();
      const newRow = tableBody.insertRow();
      newRow.innerHTML = `
        <td><input type="text" name="task_${nextIndex}" value="${cols[0] || ''}" placeholder="Enter task name"></td>
        <td>
          <div class="calendar-wrapper">
            <input type="text" class="date-input" name="due_${nextIndex}" value="${cols[1] || ''}" readonly>
            <div class="calendar-popup">
              <div class="calendar-header">
                <button class="prev-month">‚óÄ</button>
                <span class="month-label">Month Year</span>
                <button class="next-month">‚ñ∂</button>
              </div>
              <table>
                <thead>
                  <tr><th>Su</th><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th></tr>
                </thead>
                <tbody class="calendar-days"></tbody>
              </table>
            </div>
          </div>
        </td>
        <td><input type="text" name="assign_${nextIndex}" value="${cols[2] || ''}" placeholder="Enter assignee"></td>
        <td><textarea name="notes_${nextIndex}" placeholder="Enter notes">${cols[3] || ''}</textarea></td>
        <td><input type="checkbox" name="complete_${nextIndex}" ${cols[4]?.trim().toLowerCase() === 'true' ? 'checked' : ''} style="opacity:1;appearance:checkbox;margin-right:0"></td>
        <td><button class="deleteRowBtn">‚úò</button></td>
        <td></td>
      `;

      if (typeof initCalendar === "function") {
        initCalendar(newRow.querySelector(".calendar-wrapper"));
      }

    }

    // ‚úÖ Check after all rows are added
    const duplicate = checkForDuplicates();
    if (duplicate > 0) {
      messageDiv.style.display = "block";
      messageDiv.textContent = `‚ö†Ô∏è ${duplicate} duplicate task name${duplicate > 1 ? 's' : ''} found!`;
    } else {
      messageDiv.style.display = "none";
    }
  }
});
</script>





<script src="../static/assets/js/jquery.min.js"></script>
<script src="../static/assets/js/browser.min.js"></script>
<script src="../static/assets/js/breakpoints.min.js"></script>
<script src="../static/assets/js/util.js"></script>
<script src="../static/assets/js/main.js"></script>

</body>
</html>